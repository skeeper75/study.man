-- Log Data Dataset
-- Schema: application_logs, error_events

CREATE TABLE application_logs (
  id SERIAL PRIMARY KEY,
  timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  level VARCHAR(10) NOT NULL CHECK (level IN ('DEBUG', 'INFO', 'WARN', 'ERROR', 'FATAL')),
  service VARCHAR(50) NOT NULL,
  message TEXT NOT NULL,
  request_id UUID,
  user_id INT,
  duration_ms INT,
  status_code INT
);

CREATE TABLE error_events (
  id SERIAL PRIMARY KEY,
  timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  error_code VARCHAR(20) NOT NULL,
  error_message TEXT NOT NULL,
  stack_trace TEXT,
  service VARCHAR(50) NOT NULL,
  severity VARCHAR(10) CHECK (severity IN ('low', 'medium', 'high', 'critical')),
  resolved BOOLEAN DEFAULT FALSE,
  resolved_at TIMESTAMP
);

-- Seed: Application Logs (50)
INSERT INTO application_logs (level, service, message, request_id, user_id, duration_ms, status_code) VALUES
  ('INFO', 'api-gateway', 'Request received: GET /api/users', 'a1b2c3d4-e5f6-7890-abcd-ef1234567890', 1, 45, 200),
  ('INFO', 'auth-service', 'User login successful', 'a1b2c3d4-e5f6-7890-abcd-ef1234567890', 1, 120, 200),
  ('DEBUG', 'user-service', 'Fetching user profile', 'b2c3d4e5-f6a7-8901-bcde-f12345678901', 2, 30, 200),
  ('WARN', 'api-gateway', 'Rate limit approaching for IP 192.168.1.100', NULL, NULL, NULL, NULL),
  ('ERROR', 'payment-service', 'Payment processing failed: timeout', 'c3d4e5f6-a7b8-9012-cdef-123456789012', 3, 5000, 500),
  ('INFO', 'notification-service', 'Email sent to user', 'd4e5f6a7-b8c9-0123-defa-234567890123', 4, 200, 200),
  ('INFO', 'api-gateway', 'Request received: POST /api/orders', 'e5f6a7b8-c9d0-1234-efab-345678901234', 5, 350, 201),
  ('DEBUG', 'order-service', 'Validating order items', 'e5f6a7b8-c9d0-1234-efab-345678901234', 5, 15, NULL),
  ('INFO', 'order-service', 'Order created successfully', 'e5f6a7b8-c9d0-1234-efab-345678901234', 5, 280, 201),
  ('WARN', 'inventory-service', 'Low stock alert: product_id=42', NULL, NULL, NULL, NULL),
  ('ERROR', 'auth-service', 'Invalid token: expired', 'f6a7b8c9-d0e1-2345-fabc-456789012345', 6, 5, 401),
  ('INFO', 'api-gateway', 'Request received: GET /api/products', 'a7b8c9d0-e1f2-3456-abcd-567890123456', 7, 65, 200),
  ('INFO', 'search-service', 'Search query: wireless earbuds', 'b8c9d0e1-f2a3-4567-bcde-678901234567', 8, 90, 200),
  ('DEBUG', 'cache-service', 'Cache hit for key: products:list', NULL, NULL, 2, NULL),
  ('INFO', 'api-gateway', 'Request received: PUT /api/users/1', 'c9d0e1f2-a3b4-5678-cdef-789012345678', 1, 150, 200),
  ('WARN', 'security-service', 'Failed login attempt: user=admin', NULL, NULL, NULL, NULL),
  ('WARN', 'security-service', 'Failed login attempt: user=admin', NULL, NULL, NULL, NULL),
  ('ERROR', 'api-gateway', 'Request timeout: GET /api/reports', 'd0e1f2a3-b4c5-6789-defa-890123456789', 9, 30000, 504),
  ('FATAL', 'database-service', 'Connection pool exhausted', NULL, NULL, NULL, NULL),
  ('INFO', 'health-check', 'All services healthy', NULL, NULL, 5, 200),
  ('INFO', 'api-gateway', 'Request received: DELETE /api/reviews/5', 'e1f2a3b4-c5d6-7890-efab-901234567890', 10, 80, 200),
  ('DEBUG', 'review-service', 'Review deleted: id=5', 'e1f2a3b4-c5d6-7890-efab-901234567890', 10, 25, NULL),
  ('INFO', 'api-gateway', 'Request received: GET /api/orders/1', 'f2a3b4c5-d6e7-8901-fabc-012345678901', 1, 55, 200),
  ('INFO', 'analytics-service', 'Daily report generated', NULL, NULL, 1500, 200),
  ('WARN', 'api-gateway', 'Slow query detected: duration=2500ms', 'a3b4c5d6-e7f8-9012-abcd-123456789012', 11, 2500, 200),
  ('ERROR', 'email-service', 'SMTP connection refused', NULL, NULL, NULL, NULL),
  ('INFO', 'api-gateway', 'Request received: POST /api/reviews', 'b4c5d6e7-f8a9-0123-bcde-234567890123', 12, 180, 201),
  ('DEBUG', 'review-service', 'Review created: product_id=3', 'b4c5d6e7-f8a9-0123-bcde-234567890123', 12, 45, NULL),
  ('INFO', 'api-gateway', 'Request received: GET /api/search?q=laptop', 'c5d6e7f8-a9b0-1234-cdef-345678901234', 13, 110, 200),
  ('INFO', 'search-service', 'Search results: 5 items found', 'c5d6e7f8-a9b0-1234-cdef-345678901234', 13, 75, 200),
  ('WARN', 'payment-service', 'Payment retry: attempt 2/3', 'd6e7f8a9-b0c1-2345-defa-456789012345', 14, NULL, NULL),
  ('INFO', 'payment-service', 'Payment successful after retry', 'd6e7f8a9-b0c1-2345-defa-456789012345', 14, 800, 200),
  ('ERROR', 'upload-service', 'File too large: 25MB exceeds 10MB limit', 'e7f8a9b0-c1d2-3456-efab-567890123456', 15, 10, 413),
  ('INFO', 'api-gateway', 'Request received: GET /api/dashboard', 'f8a9b0c1-d2e3-4567-fabc-678901234567', 1, 200, 200),
  ('DEBUG', 'dashboard-service', 'Aggregating metrics', 'f8a9b0c1-d2e3-4567-fabc-678901234567', 1, 150, NULL),
  ('INFO', 'api-gateway', 'Request received: POST /api/auth/logout', 'a9b0c1d2-e3f4-5678-abcd-789012345678', 1, 25, 200),
  ('INFO', 'auth-service', 'User logged out', 'a9b0c1d2-e3f4-5678-abcd-789012345678', 1, 10, 200),
  ('WARN', 'api-gateway', 'Deprecated endpoint accessed: /api/v1/users', NULL, NULL, NULL, NULL),
  ('ERROR', 'notification-service', 'Push notification failed: device not registered', 'b0c1d2e3-f4a5-6789-bcde-890123456789', 16, 50, 404),
  ('INFO', 'cron-service', 'Cleanup job completed: removed 150 expired sessions', NULL, NULL, 3000, 200),
  ('DEBUG', 'cache-service', 'Cache miss for key: user:profile:17', NULL, NULL, 1, NULL),
  ('INFO', 'api-gateway', 'Request received: GET /api/users/17', 'c1d2e3f4-a5b6-7890-cdef-901234567890', 17, 40, 200),
  ('INFO', 'user-service', 'User profile loaded', 'c1d2e3f4-a5b6-7890-cdef-901234567890', 17, 20, 200),
  ('WARN', 'monitoring-service', 'CPU usage above 80% on worker-3', NULL, NULL, NULL, NULL),
  ('INFO', 'api-gateway', 'Request received: PATCH /api/products/5', 'd2e3f4a5-b6c7-8901-defa-012345678901', 18, 95, 200),
  ('ERROR', 'inventory-service', 'Negative stock detected: product_id=7', NULL, NULL, NULL, NULL),
  ('INFO', 'api-gateway', 'Request received: GET /api/notifications', 'e3f4a5b6-c7d8-9012-efab-123456789012', 19, 30, 200),
  ('INFO', 'notification-service', 'Fetched 5 unread notifications', 'e3f4a5b6-c7d8-9012-efab-123456789012', 19, 15, 200),
  ('DEBUG', 'api-gateway', 'Request completed', 'e3f4a5b6-c7d8-9012-efab-123456789012', 19, 35, 200),
  ('INFO', 'health-check', 'Scheduled health check completed', NULL, NULL, 10, 200);

-- Seed: Error Events (20)
INSERT INTO error_events (error_code, error_message, stack_trace, service, severity, resolved) VALUES
  ('PAY-001', 'Payment gateway timeout', 'at PaymentService.process(payment.ts:45)\n  at OrderService.checkout(order.ts:120)', 'payment-service', 'high', TRUE),
  ('AUTH-001', 'Token validation failed', 'at AuthMiddleware.verify(auth.ts:30)\n  at Router.handle(router.ts:55)', 'auth-service', 'medium', TRUE),
  ('DB-001', 'Connection pool exhausted', 'at Pool.acquire(pool.ts:80)\n  at QueryRunner.execute(runner.ts:25)', 'database-service', 'critical', TRUE),
  ('API-001', 'Request timeout exceeded', 'at TimeoutMiddleware.check(timeout.ts:15)\n  at Router.handle(router.ts:60)', 'api-gateway', 'medium', FALSE),
  ('EMAIL-001', 'SMTP connection refused', 'at SMTPClient.connect(smtp.ts:40)\n  at EmailService.send(email.ts:70)', 'email-service', 'high', FALSE),
  ('UPLOAD-001', 'File size limit exceeded', 'at UploadMiddleware.validate(upload.ts:20)\n  at FileService.process(file.ts:35)', 'upload-service', 'low', TRUE),
  ('PAY-002', 'Invalid card number', 'at CardValidator.check(validator.ts:55)\n  at PaymentService.process(payment.ts:48)', 'payment-service', 'low', TRUE),
  ('NOTIF-001', 'Push notification delivery failed', 'at PushService.send(push.ts:60)\n  at NotificationService.notify(notify.ts:90)', 'notification-service', 'medium', FALSE),
  ('INV-001', 'Negative stock detected', 'at InventoryService.update(inventory.ts:75)\n  at OrderService.fulfill(order.ts:150)', 'inventory-service', 'high', FALSE),
  ('CACHE-001', 'Redis connection lost', 'at RedisClient.ping(redis.ts:25)\n  at CacheService.get(cache.ts:40)', 'cache-service', 'high', TRUE),
  ('API-002', 'Rate limit exceeded', 'at RateLimiter.check(limiter.ts:30)\n  at Router.handle(router.ts:45)', 'api-gateway', 'medium', TRUE),
  ('SEC-001', 'Brute force attempt detected', 'at SecurityService.detect(security.ts:100)\n  at AuthService.login(auth.ts:60)', 'security-service', 'critical', TRUE),
  ('DB-002', 'Deadlock detected', 'at TransactionManager.execute(tx.ts:90)\n  at OrderService.update(order.ts:180)', 'database-service', 'high', TRUE),
  ('API-003', 'Invalid request body', 'at Validator.parse(validator.ts:15)\n  at Router.handle(router.ts:50)', 'api-gateway', 'low', TRUE),
  ('SEARCH-001', 'Elasticsearch cluster unhealthy', 'at ESClient.health(es.ts:35)\n  at SearchService.query(search.ts:55)', 'search-service', 'critical', FALSE),
  ('PAY-003', 'Duplicate transaction detected', 'at IdempotencyCheck.verify(idempotency.ts:20)\n  at PaymentService.process(payment.ts:42)', 'payment-service', 'medium', TRUE),
  ('AUTH-002', 'OAuth provider unavailable', 'at OAuthClient.authorize(oauth.ts:45)\n  at AuthService.socialLogin(auth.ts:80)', 'auth-service', 'high', FALSE),
  ('CRON-001', 'Scheduled job failed', 'at JobRunner.execute(job.ts:60)\n  at CronService.run(cron.ts:30)', 'cron-service', 'medium', TRUE),
  ('MONITOR-001', 'CPU threshold exceeded', 'at Monitor.check(monitor.ts:50)\n  at AlertService.trigger(alert.ts:25)', 'monitoring-service', 'medium', FALSE),
  ('DB-003', 'Query execution timeout', 'at QueryRunner.execute(runner.ts:30)\n  at ReportService.generate(report.ts:100)', 'database-service', 'high', FALSE);
